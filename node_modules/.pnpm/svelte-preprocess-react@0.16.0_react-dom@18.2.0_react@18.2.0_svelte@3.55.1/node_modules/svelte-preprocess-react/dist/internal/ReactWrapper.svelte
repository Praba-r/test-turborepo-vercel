<script>import { writable } from "svelte/store";
import {
  beforeUpdate,
  getAllContexts,
  getContext,
  onDestroy,
  setContext
} from "svelte";
export let svelteInit;
const props = writable(extractProps($$props));
const target = writable();
const slot = writable();
const hooks = writable([]);
const listeners = [];
const parent = getContext("ReactWrapper");
const node = svelteInit({
  parent,
  props,
  target,
  slot,
  hooks,
  contexts: getAllContexts(),
  onDestroy(callback) {
    listeners.push(callback);
  }
});
setContext("ReactWrapper", node);
beforeUpdate(() => {
  props.set(extractProps($$props));
});
onDestroy(() => {
  listeners.forEach((callback) => callback());
});
function extractProps(values) {
  const { svelteInit: excluded, ...rest } = values;
  return rest;
}
</script>

<react-portal-target bind:this={$target} />

{#if $$slots.default}
  <svelte-slot bind:this={$slot}><slot /></svelte-slot>
{/if}

<style>
  react-portal-target {
    display: contents;
  }
  svelte-slot {
    display: none;
  }
</style>
